<!-- src/app/queues/queues.html -->
<div class="p-6 space-y-6">
  <!-- Header -->
  <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
    <div class="flex items-center gap-4">
      <div class="w-12 h-12 rounded-2xl bg-[#2E86AB] flex items-center justify-center shadow-lg" 
           style="background: linear-gradient(135deg, #2E86AB 0%, #56cfe1 100%);">
        <span class="material-icons-outlined text-white text-2xl">queue</span>
      </div>
      <div>
        <h1 class="text-3xl font-bold text-gray-800">Gestión de Colas</h1>
        <p class="text-sm text-gray-500 mt-1">Administra las colas del call center</p>
      </div>
    </div>
    
    <div class="flex items-center gap-3">
      <button (click)="loadQueues()" class="btn-primary" [disabled]="loading">
        <span class="material-icons-outlined text-lg" [class.rotate-animation]="loading">refresh</span>
        {{ loading ? 'Cargando...' : 'Recargar' }}
      </button>
      <button (click)="openCreateModal()" class="btn-primary">
        <span class="material-icons-outlined text-lg">add</span>
        Nueva Cola
      </button>
    </div>
  </div>

  <!-- Barra de búsqueda -->
  @if (queues.length > 0) {
    <div class="bg-white rounded-xl border border-gray-200 p-4 shadow-sm">
      <div class="flex items-center gap-3">
        <span class="material-icons-outlined text-gray-400">search</span>
        <input 
          type="text"
          [(ngModel)]="searchTerm"
          (input)="filterQueues()"
          placeholder="Buscar por nombre o descripción..."
          class="flex-1 outline-none text-gray-700">
        @if (searchTerm) {
          <button (click)="searchTerm = ''; filterQueues()" class="text-gray-400 hover:text-gray-600">
            <span class="material-icons-outlined">close</span>
          </button>
        }
      </div>
    </div>
  }

  <!-- Tabla de Colas - Estilo moderno como calls -->
  <div class="calls-table-modern">
    <div class="px-6 py-5 border-b border-gray-100">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <span class="material-icons-outlined text-[#2E86AB]">list</span>
          <h2 class="text-xl font-bold text-gray-800">Colas Registradas</h2>
          @if (!loading) {
            <span class="text-sm text-gray-500">({{ filteredQueues.length }} cola{{ filteredQueues.length !== 1 ? 's' : '' }})</span>
          }
        </div>
      </div>
    </div>

    @if (loading) {
      <!-- Estado de carga -->
      <div class="p-12 text-center">
        <div class="spinner mx-auto mb-4"></div>
        <p class="text-gray-500">Cargando colas...</p>
        <p class="text-xs text-gray-400 mt-2">Consultando base de datos...</p>
      </div>
    } @else if (filteredQueues.length === 0) {
      <!-- Sin resultados -->
      <div class="p-12 text-center">
        <div class="w-20 h-20 rounded-full bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center mx-auto mb-4">
          <span class="material-icons-outlined text-gray-400 text-4xl">queue_music</span>
        </div>
        <h3 class="text-xl font-semibold text-gray-800 mb-2">
          @if (searchTerm) {
            No se encontraron colas
          } @else {
            No hay colas registradas
          }
        </h3>
        <p class="text-gray-500 mb-4">
          @if (searchTerm) {
            Intenta con otro término de búsqueda
          } @else {
            Crea una nueva cola para comenzar
          }
        </p>
        @if (!searchTerm) {
          <button (click)="openCreateModal()" class="btn-primary inline-flex">
            <span class="material-icons-outlined text-lg">add</span>
            Crear primera cola
          </button>
        }
      </div>
    } @else {
      <!-- Tabla con datos - Estilo moderno como calls -->
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="bg-gray-100 border-b border-gray-200">
            <tr>
              <th class="px-6 py-3 text-left">
                <div class="flex items-center gap-2">
                  <span class="material-icons-outlined text-base">tag</span>
                  <span class="text-xs font-semibold text-[#2E86AB] uppercase tracking-wide">Device ID</span>
                </div>
              </th>
              <th class="px-6 py-3 text-left">
                <div class="flex items-center gap-2">
                  <span class="material-icons-outlined text-base">queue</span>
                  <span class="text-xs font-semibold text-[#2E86AB] uppercase tracking-wide">Nombre de Cola</span>
                </div>
              </th>
              <th class="px-6 py-3 text-center">
                <div class="flex items-center justify-center gap-2">
                  <span class="material-icons-outlined text-base">settings</span>
                  <span class="text-xs font-semibold text-[#2E86AB] uppercase tracking-wide">Acciones</span>
                </div>
              </th>
            </tr>
          </thead>
          <tbody>
            @for (queue of filteredQueues; track queue.device) {
              <tr class="call-row">
                <!-- Device ID -->
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-[#2E86AB] to-[#56cfe1] flex items-center justify-center shadow-md">
                      <span class="material-icons-outlined text-white text-lg">dialpad</span>
                    </div>
                    <div>
                      <p class="text-sm font-bold text-gray-800">{{ queue.device }}</p>
                      <p class="text-xs text-gray-500">ID del dispositivo</p>
                    </div>
                  </div>
                </td>

                <!-- Nombre de Cola -->
                <td class="px-6 py-4">
                  <div class="flex items-center gap-2">
                    <span class="material-icons-outlined text-green-600">call_end</span>
                    <span class="text-sm font-semibold text-gray-800">{{ queue.queue }}</span>
                  </div>
                </td>

                <!-- Acciones -->
                <td class="px-6 py-4">
                  <div class="flex items-center justify-center gap-2">
                    <button 
                      (click)="openEditModal(queue)"
                      class="btn-detail"
                      title="Editar cola">
                      <span class="material-icons-outlined text-base">edit</span>
                      Editar
                    </button>
                    <button 
                      (click)="deleteQueue(queue)"
                      class="btn-detail"
                      style="border-color: #ef4444; color: #ef4444;"
                      title="Eliminar cola">
                      <span class="material-icons-outlined text-base">delete</span>
                      Eliminar
                    </button>
                  </div>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
      
      <!-- Info adicional -->
      <div class="px-6 py-4 bg-gray-50 border-t border-gray-100">
        <p class="text-sm text-gray-500 text-center">
          Mostrando {{ filteredQueues.length }} de {{ queues.length }} cola{{ queues.length !== 1 ? 's' : '' }}
        </p>
      </div>
    }
  </div>
</div>

<!-- Modal de Crear/Editar -->
@if (showModal) {
  <div class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()" style="max-width: 600px;">
      <!-- Header del Modal -->
      <div class="modal-header">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-100 to-blue-200 flex items-center justify-center">
            <span class="material-icons-outlined text-blue-600">queue</span>
          </div>
          <div>
            <h2 class="text-2xl font-bold text-gray-800">{{ modalTitle }}</h2>
            <p class="text-sm text-gray-500">Complete los datos de la cola</p>
          </div>
        </div>
        <button (click)="closeModal()" class="close-button">
          <span class="material-icons-outlined">close</span>
        </button>
      </div>

      <!-- Contenido del Modal -->
      <div class="modal-body">
        <form class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Nombre de la Cola *
            </label>
            <input 
              type="text"
              [(ngModel)]="formQueue.queue"
              name="queue"
              placeholder="Ej: ventas, soporte, general"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
              required>
            <p class="text-xs text-gray-500 mt-1">
              Este nombre se utilizará para identificar la cola en el sistema
            </p>
          </div>
        </form>
      </div>

      <!-- Footer del Modal -->
      <div class="modal-footer">
        <button (click)="closeModal()" class="btn-secondary">
          Cancelar
        </button>
        <button (click)="saveQueue()" class="btn-primary" [disabled]="!formQueue.queue.trim()">
          <span class="material-icons-outlined text-lg">save</span>
          {{ editingQueue ? 'Actualizar' : 'Crear' }}
        </button>
      </div>
    </div>
  </div>
}

<!-- CSS necesario para animación -->
<style>
  @keyframes rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }
  
  .rotate-animation {
    animation: rotate 1s linear infinite;
  }
</style>